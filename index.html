<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for hourly forecast */
        .hourly-forecast::-webkit-scrollbar {
            height: 4px;
        }
        .hourly-forecast::-webkit-scrollbar-track {
            background: #2d3748; /* gray-800 */
        }
        .hourly-forecast::-webkit-scrollbar-thumb {
            background: #4a5568; /* gray-600 */
            border-radius: 2px;
        }
        .hourly-forecast::-webkit-scrollbar-thumb:hover {
            background: #718096; /* gray-500 */
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-left: -20px;
            margin-top: -20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="container mx-auto p-4 md:p-8">
        <h1 class="text-3xl font-bold text-center mb-8">Live Weather Dashboard</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Location 1: San Francisco -->
            <div id="location-1" class="bg-gray-800 p-6 rounded-lg shadow-lg relative">
                <div class="flex justify-center items-center mb-4">
                    <h2 id="location-name-1" class="text-2xl font-semibold">Loading...</h2>
                </div>
                <div id="weather-content-1">
                    <!-- Current Weather -->
                    <div class="text-center mb-6">
                        <p id="weather-description-1" class="text-xl text-gray-400 mb-2"></p>
                        <div class="flex justify-center items-center gap-4">
                             <i id="weather-icon-1" class="fas text-6xl"></i>
                             <p id="current-temp-1" class="text-7xl font-bold"></p>
                        </div>
                        <div class="flex justify-center gap-4 text-lg mt-2">
                            <p>High: <span id="high-temp-1"></span></p>
                            <p>Low: <span id="low-temp-1"></span></p>
                        </div>
                    </div>

                    <!-- Hourly Forecast -->
                    <h3 class="text-xl font-semibold mb-3">Hourly Forecast</h3>
                    <div id="hourly-forecast-1" class="hourly-forecast flex overflow-x-auto space-x-4 pb-4"></div>

                    <!-- Graphs -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                        <div>
                            <h3 class="text-xl font-semibold mb-3 text-center">UV Index</h3>
                            <canvas id="uv-chart-1"></canvas>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-3 text-center">Precipitation</h3>
                            <canvas id="precipitation-chart-1"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Location 2: Mountain View -->
            <div id="location-2" class="bg-gray-800 p-6 rounded-lg shadow-lg relative">
                <div class="flex justify-center items-center mb-4">
                    <h2 id="location-name-2" class="text-2xl font-semibold">Loading...</h2>
                </div>
                <div id="weather-content-2">
                    <!-- Current Weather -->
                    <div class="text-center mb-6">
                        <p id="weather-description-2" class="text-xl text-gray-400 mb-2"></p>
                         <div class="flex justify-center items-center gap-4">
                             <i id="weather-icon-2" class="fas text-6xl"></i>
                             <p id="current-temp-2" class="text-7xl font-bold"></p>
                        </div>
                        <div class="flex justify-center gap-4 text-lg mt-2">
                            <p>High: <span id="high-temp-2"></span></p>
                            <p>Low: <span id="low-temp-2"></span></p>
                        </div>
                    </div>

                    <!-- Hourly Forecast -->
                    <h3 class="text-xl font-semibold mb-3">Hourly Forecast</h3>
                    <div id="hourly-forecast-2" class="hourly-forecast flex overflow-x-auto space-x-4 pb-4"></div>

                    <!-- Graphs -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                        <div>
                            <h3 class="text-xl font-semibold mb-3 text-center">UV Index</h3>
                            <canvas id="uv-chart-2"></canvas>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-3 text-center">Precipitation</h3>
                            <canvas id="precipitation-chart-2"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let chartInstances = { 1: {}, 2: {} };

        const wmoWeatherIcons = {
            day: {
                0: { description: 'Clear sky', icon: 'fa-sun', color: 'text-yellow-400' }, 1: { description: 'Mainly clear', icon: 'fa-cloud-sun', color: 'text-yellow-300' }, 2: { description: 'Partly cloudy', icon: 'fa-cloud', color: 'text-gray-400' }, 3: { description: 'Overcast', icon: 'fa-cloud', color: 'text-gray-500' }, 45: { description: 'Fog', icon: 'fa-smog', color: 'text-gray-500' }, 48: { description: 'Rime fog', icon: 'fa-smog', color: 'text-gray-500' }, 51: { description: 'Light drizzle', icon: 'fa-cloud-rain', color: 'text-blue-300' }, 53: { description: 'Moderate drizzle', icon: 'fa-cloud-rain', color: 'text-blue-400' }, 55: { description: 'Dense drizzle', icon: 'fa-cloud-showers-heavy', color: 'text-blue-500' }, 61: { description: 'Slight rain', icon: 'fa-cloud-sun-rain', color: 'text-blue-300' }, 63: { description: 'Moderate rain', icon: 'fa-cloud-showers-heavy', color: 'text-blue-400' }, 65: { description: 'Heavy rain', icon: 'fa-cloud-showers-heavy', color: 'text-blue-500' }, 71: { description: 'Slight snow fall', icon: 'fa-snowflake', color: 'text-blue-200' }, 73: { description: 'Moderate snow fall', icon: 'fa-snowflake', color: 'text-blue-200' }, 75: { description: 'Heavy snow fall', icon: 'fa-snowflake', color: 'text-blue-200' }, 80: { description: 'Slight rain showers', icon: 'fa-cloud-sun-rain', color: 'text-blue-300' }, 81: { description: 'Moderate rain showers', icon: 'fa-cloud-showers-heavy', color: 'text-blue-400' }, 82: { description: 'Violent rain showers', icon: 'fa-cloud-showers-heavy', color: 'text-blue-500' }, 85: { description: 'Slight snow showers', icon: 'fa-snowflake', color: 'text-blue-200' }, 86: { description: 'Heavy snow showers', icon: 'fa-snowflake', color: 'text-blue-200' }, 95: { description: 'Thunderstorm', icon: 'fa-bolt', color: 'text-yellow-500' },
            },
            night: {
                0: { description: 'Clear sky', icon: 'fa-moon', color: 'text-blue-200' }, 1: { description: 'Mainly clear', icon: 'fa-cloud-moon', color: 'text-blue-300' }, 2: { description: 'Partly cloudy', icon: 'fa-cloud', color: 'text-gray-400' }, 3: { description: 'Overcast', icon: 'fa-cloud', color: 'text-gray-500' }, 45: { description: 'Fog', icon: 'fa-smog', color: 'text-gray-500' }, 48: { description: 'Rime fog', icon: 'fa-smog', color: 'text-gray-500' }, 51: { description: 'Light drizzle', icon: 'fa-cloud-rain', color: 'text-blue-300' }, 53: { description: 'Moderate drizzle', icon: 'fa-cloud-rain', color: 'text-blue-400' }, 55: { description: 'Dense drizzle', icon: 'fa-cloud-showers-heavy', color: 'text-blue-500' }, 61: { description: 'Slight rain', icon: 'fa-cloud-moon-rain', color: 'text-blue-300' }, 63: { description: 'Moderate rain', icon: 'fa-cloud-showers-heavy', color: 'text-blue-400' }, 65: { description: 'Heavy rain', icon: 'fa-cloud-showers-heavy', color: 'text-blue-500' }, 71: { description: 'Slight snow fall', icon: 'fa-snowflake', color: 'text-blue-200' }, 73: { description: 'Moderate snow fall', icon: 'fa-snowflake', color: 'text-blue-200' }, 75: { description: 'Heavy snow fall', icon: 'fa-snowflake', color: 'text-blue-200' }, 80: { description: 'Slight rain showers', icon: 'fa-cloud-moon-rain', color: 'text-blue-300' }, 81: { description: 'Moderate rain showers', icon: 'fa-cloud-showers-heavy', color: 'text-blue-400' }, 82: { description: 'Violent rain showers', icon: 'fa-cloud-showers-heavy', color: 'text-blue-500' }, 85: { description: 'Slight snow showers', icon: 'fa-snowflake', color: 'text-blue-200' }, 86: { description: 'Heavy snow showers', icon: 'fa-snowflake', color: 'text-blue-200' }, 95: { description: 'Thunderstorm', icon: 'fa-bolt', color: 'text-yellow-500' },
            }
        };
        
        function showLoader(locationId) {
            const content = document.getElementById(`weather-content-${locationId}`);
            content.style.display = 'none';
            let loader = document.getElementById(`loader-${locationId}`);
            if (!loader) {
                loader = document.createElement('div');
                loader.id = `loader-${locationId}`;
                loader.className = 'loader';
                document.getElementById(`location-${locationId}`).appendChild(loader);
            }
        }

        function hideLoader(locationId) {
             const content = document.getElementById(`weather-content-${locationId}`);
            content.style.display = 'block';
            const loader = document.getElementById(`loader-${locationId}`);
            if (loader) {
                loader.remove();
            }
        }

        function showError(locationId, message) {
            document.getElementById(`location-name-${locationId}`).textContent = "Error";
            document.getElementById(`weather-description-${locationId}`).textContent = message;
        }

        async function getWeather(locationId, locationInfo = null) {
            if (!locationInfo) {
                showError(locationId, "Location information is missing.");
                return;
            }
            
            showLoader(locationId);
            
            try {
                const { lat, lon, name } = locationInfo;
                
                const weatherParams = new URLSearchParams({
                    latitude: lat, longitude: lon, current: 'temperature_2m,weather_code,is_day', hourly: 'temperature_2m,precipitation_probability,weather_code,uv_index', daily: 'weather_code,temperature_2m_max,temperature_2m_min,uv_index_max', temperature_unit: 'fahrenheit', wind_speed_unit: 'mph', precipitation_unit: 'inch', timezone: 'auto', past_days: 1
                });
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?${weatherParams}`;
                const weatherResponse = await fetch(weatherUrl);
                const weatherData = await weatherResponse.json();

                updateUI(locationId, weatherData, name);

            } catch (error) {
                console.error("Error fetching weather data:", error);
                showError(locationId, error.message);
            } finally {
                hideLoader(locationId);
            }
        }
        
        function updateUI(locationId, data, displayName) {
            document.getElementById(`location-name-${locationId}`).textContent = displayName;
            
            const { current, daily, hourly } = data;
            const isDay = current.is_day;
            const currentWmoCode = current.weather_code;
            const currentIconSet = isDay ? wmoWeatherIcons.day : wmoWeatherIcons.night;
            const weatherIconData = currentIconSet[currentWmoCode] || wmoWeatherIcons.day[2];

            document.getElementById(`weather-description-${locationId}`).textContent = weatherIconData.description;
            document.getElementById(`current-temp-${locationId}`).innerHTML = `${Math.round(current.temperature_2m)}째`;
            document.getElementById(`high-temp-${locationId}`).innerHTML = `${Math.round(daily.temperature_2m_max[0])}째`;
            document.getElementById(`low-temp-${locationId}`).innerHTML = `${Math.round(daily.temperature_2m_min[0])}째`;
            
            const iconEl = document.getElementById(`weather-icon-${locationId}`);
            iconEl.className = `fas ${weatherIconData.icon} text-6xl ${weatherIconData.color}`;

            const hourlyContainer = document.getElementById(`hourly-forecast-${locationId}`);
            hourlyContainer.innerHTML = '';

            const now = new Date();
            const futureIndex = hourly.time.findIndex(t => new Date(t) > now);
            let startIndex = Math.max(0, futureIndex - 1);
            const endIndex = startIndex + 24;

            for (let i = startIndex; i < endIndex && i < hourly.time.length; i++) {
                const date = new Date(hourly.time[i]);
                const temp = hourly.temperature_2m[i];
                const wmoCode = hourly.weather_code[i];
                const hourOfDay = date.getHours();
                const hourlyIconSet = (hourOfDay >= 6 && hourOfDay < 19) ? wmoWeatherIcons.day : wmoWeatherIcons.night;
                const hourIconData = hourlyIconSet[wmoCode] || wmoWeatherIcons.day[2];
                const hourEl = document.createElement('div');
                hourEl.className = 'flex flex-col items-center space-y-1 p-2 rounded-lg bg-gray-700/50 flex-shrink-0';
                const timeString = date.toLocaleTimeString([], { hour: 'numeric', hour12: true }).replace(' ', '');
                hourEl.innerHTML = `<p class="text-sm text-gray-300">${timeString}</p><i class="fas ${hourIconData.icon} text-2xl ${hourIconData.color}"></i><p class="font-semibold">${Math.round(temp)}째</p>`;
                hourlyContainer.appendChild(hourEl);
            }
            
            const todayStr = new Date().toISOString().slice(0, 10);
            const pastAndTodayUVData = hourly.time
                .map((t, i) => ({ time: new Date(t), uv: hourly.uv_index[i] }))
                .filter(d => d.time.toISOString().slice(0,10) === todayStr && d.uv > 0);

            const uvLabels = pastAndTodayUVData.map(d => d.time.toLocaleTimeString([], { hour: 'numeric', hour12: true }).replace(' ', ''));
            const uvData = pastAndTodayUVData.map(d => d.uv);
            
            createUVChart(locationId, uvData, uvLabels);
            
            const precipData = hourly.precipitation_probability.slice(startIndex, endIndex);
            const precipLabels = hourly.time.slice(startIndex, endIndex).map(t => new Date(t).toLocaleTimeString([], { hour: 'numeric', hour12: true }).replace(' ', ''));
            createPrecipitationChart(locationId, precipData, precipLabels);
        }

        function createChart(locationId, chartElementId, instanceName, config) {
            if (chartInstances[locationId] && chartInstances[locationId][instanceName]) {
                chartInstances[locationId][instanceName].destroy();
            }
            const ctx = document.getElementById(chartElementId).getContext('2d');
            chartInstances[locationId][instanceName] = new Chart(ctx, config);
        }

        function createUVChart(locationId, uvData, uvLabels) {
            const chartConfig = {
                type: 'line',
                data: { labels: uvLabels, datasets: [{ label: 'UV Index', data: uvData, backgroundColor: 'rgba(139, 92, 246, 0.2)', borderColor: 'rgba(139, 92, 246, 1)', borderWidth: 2, fill: true, tension: 0.4, pointBackgroundColor: 'rgba(139, 92, 246, 1)', }] },
                options: { scales: { y: { beginAtZero: true, max: 12, ticks: { color: '#9CA3AF' }}, x: { ticks: { color: '#9CA3AF', maxRotation: 90, minRotation: 70 }}}, plugins: { legend: { display: false } } }
            };
            createChart(locationId, `uv-chart-${locationId}`, 'uvChart', chartConfig);
        }
        
        function createPrecipitationChart(locationId, precipData, precipLabels) {
            const chartConfig = {
                type: 'bar',
                data: { labels: precipLabels, datasets: [{ label: 'Precipitation Chance', data: precipData, backgroundColor: 'rgba(59, 130, 246, 0.5)', borderColor: 'rgba(59, 130, 246, 1)', borderWidth: 1 }] },
                options: { scales: { y: { beginAtZero: true, max: 100, ticks: { color: '#9CA3AF', callback: v => v + '%' }}, x: { ticks: { color: '#9CA3AF', maxRotation: 90, minRotation: 70 }}}, plugins: { legend: { display: false } } }
            };
            createChart(locationId, `precipitation-chart-${locationId}`, 'precipitationChart', chartConfig);
        }
        
        window.onload = () => {
            getWeather(1, { lat: 37.7713, lon: -122.4363, name: "San Francisco, CA" });
            getWeather(2, { lat: 37.422543, lon: -122.087674, name: "Mountain View, CA" });
        };
    </script>
</body>
</html>
